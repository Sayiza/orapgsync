# Code Generator for Semantic Syntax Tree

This directory contains the code generator that creates semantic node classes and the tree builder from the ANTLR grammar.

## Usage

```bash
python3 codegen/generate.py
```

## What It Does

1. **Parses** `PlSqlParser.g4` to extract all grammar rules
2. **Generates** semantic node classes for each rule
3. **Generates** `SemanticTreeBuilder.java` with all visitor methods
4. **Skips** existing files (won't overwrite your work)

## File Organization

Generated files are organized by rule type:

- `semantic/statement/` - Statement nodes (e.g., SelectStatement)
- `semantic/expression/` - Expression nodes (e.g., LogicalExpression)
- `semantic/clause/` - Clause nodes (e.g., WhereClause, FromClause)
- `semantic/query/` - Query-related nodes (e.g., Subquery, QueryBlock)
- `semantic/element/` - Element nodes (e.g., TableReference, ColumnReference)
- `semantic/misc/` - Other nodes

## Regenerating Files

To regenerate a file:

1. Delete the file you want to regenerate
2. Run `python3 codegen/generate.py`
3. The generator will recreate only the missing files

Example:
```bash
# Regenerate SelectStatement
rm src/main/java/me/christianrobert/orapgsync/transformation/semantic/statement/SelectStatement.java

# Regenerate
python3 codegen/generate.py
```

## Generated Code Structure

### Semantic Node Classes

Each semantic node class contains:

- **Fields**: Child nodes and tokens from the grammar rule
- **Constructor**: Initializes all fields
- **Getters**: Access child nodes
- **toPostgres()**: Stub method throwing "not implemented" exception

Example:
```java
public class SelectStatement implements SemanticNode {
    private final SelectOnlyStatement selectOnlyStatement;

    public SelectStatement(SelectOnlyStatement selectOnlyStatement) {
        this.selectOnlyStatement = selectOnlyStatement;
    }

    public SelectOnlyStatement getSelectOnlyStatement() {
        return selectOnlyStatement;
    }

    @Override
    public String toPostgres(TransformationContext ctx) {
        // TODO: Implement transformation logic
        throw new TransformationException("select_statement transformation not yet implemented");
    }
}
```

### SemanticTreeBuilder

The tree builder contains visit methods that:

1. Extract child nodes from ANTLR context
2. Call `visit()` recursively on children
3. Construct semantic node with children
4. Handle null checks and errors

Example:
```java
@Override
public SemanticNode visitSelect_statement(PlSqlParser.Select_statementContext ctx) {
    SelectOnlyStatement selectOnlyStatement;
    if (ctx.select_only_statement() == null) {
        throw new TransformationException("select_statement missing select_only_statement");
    }
    selectOnlyStatement = (SelectOnlyStatement) visit(ctx.select_only_statement());
    return new SelectStatement(selectOnlyStatement);
}
```

## Implementation Workflow

After generation:

1. **Review generated code** - Check that structure matches expectations
2. **Compile project** - `mvn clean compile` to check for errors
3. **Implement toPostgres()** - Replace stub implementations with actual transformation logic
4. **Write tests** - Unit test each toPostgres() method
5. **Track progress** - Count implemented vs total toPostgres() methods

## Notes

- Generated code is marked with "Generated by codegen/generate.py - DO NOT EDIT MANUALLY"
- If you need custom logic in extraction, delete the generated file and write manually
- Grammar is assumed stable - manual fixes if needed
- Generator is run manually, not part of Maven build (avoids conflicts with hand-coded implementations)
